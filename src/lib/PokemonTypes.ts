import type { PartyPokemon } from "./PartyPokemon"
import type { Pokemon } from "./Pokemon"
import type { Skill } from "./Skill"

export type PokemonType = "ノーマル"
    | "ほのお"
    | "みず"
    | "でんき"
    | "くさ"
    | "こおり"
    | "かくとう"
    | "どく"
    | "じめん"
    | "ひこう"
    | "エスパー"
    | "むし"
    | "いわ"
    | "ゴースト"
    | "ドラゴン"
    | "あく"
    | "はがね"
    | "フェアリー"

export type Compatibility = "◯" | "△" | "×" | " "

export const TypeCompatibilityList: {
    [type in PokemonType]: {
        [type in PokemonType]: Compatibility
    }
} = {
    ノーマル: {
        ノーマル: " ",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: " ",
        かくとう: " ",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: " ",
        むし: " ",
        いわ: "△",
        ゴースト: "×",
        ドラゴン: " ",
        あく: " ",
        はがね: "△",
        フェアリー: " ",
    },
    ほのお: {
        ノーマル: " ",
        ほのお: "△",
        みず: "△",
        でんき: " ",
        くさ: "◯",
        こおり: "◯",
        かくとう: " ",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: " ",
        むし: "◯",
        いわ: "△",
        ゴースト: " ",
        ドラゴン: "△",
        あく: " ",
        はがね: "◯",
        フェアリー: " ",
    },
    みず: {
        ノーマル: " ",
        ほのお: "◯",
        みず: "△",
        でんき: " ",
        くさ: "△",
        こおり: " ",
        かくとう: " ",
        どく: " ",
        じめん: "◯",
        ひこう: " ",
        エスパー: " ",
        むし: " ",
        いわ: "◯",
        ゴースト: " ",
        ドラゴン: "△",
        あく: " ",
        はがね: " ",
        フェアリー: " ",
    },
    でんき: {
        ノーマル: " ",
        ほのお: " ",
        みず: "◯",
        でんき: "△",
        くさ: "△",
        こおり: " ",
        かくとう: " ",
        どく: " ",
        じめん: "×",
        ひこう: "◯",
        エスパー: " ",
        むし: " ",
        いわ: " ",
        ゴースト: " ",
        ドラゴン: "△",
        あく: " ",
        はがね: " ",
        フェアリー: " ",
    },
    くさ: {
        ノーマル: " ",
        ほのお: "△",
        みず: "◯",
        でんき: " ",
        くさ: "△",
        こおり: " ",
        かくとう: " ",
        どく: "△",
        じめん: "◯",
        ひこう: "△",
        エスパー: " ",
        むし: "△",
        いわ: "◯",
        ゴースト: " ",
        ドラゴン: "△",
        あく: " ",
        はがね: "△",
        フェアリー: " ",
    },
    こおり: {
        ノーマル: " ",
        ほのお: "△",
        みず: "△",
        でんき: " ",
        くさ: "◯",
        こおり: "△",
        かくとう: " ",
        どく: " ",
        じめん: "◯",
        ひこう: "◯",
        エスパー: " ",
        むし: " ",
        いわ: " ",
        ゴースト: " ",
        ドラゴン: "◯",
        あく: " ",
        はがね: "△",
        フェアリー: " ",
    },
    かくとう: {
        ノーマル: "◯",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: "◯",
        かくとう: " ",
        どく: "△",
        じめん: " ",
        ひこう: "△",
        エスパー: "△",
        むし: "△",
        いわ: "◯",
        ゴースト: "×",
        ドラゴン: " ",
        あく: "◯",
        はがね: "◯",
        フェアリー: "△",
    },
    どく: {
        ノーマル: " ",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: "◯",
        こおり: " ",
        かくとう: " ",
        どく: "△",
        じめん: "△",
        ひこう: " ",
        エスパー: " ",
        むし: " ",
        いわ: "△",
        ゴースト: "△",
        ドラゴン: " ",
        あく: " ",
        はがね: "×",
        フェアリー: "◯",
    },
    じめん: {
        ノーマル: " ",
        ほのお: "◯",
        みず: " ",
        でんき: "◯",
        くさ: "△",
        こおり: " ",
        かくとう: " ",
        どく: "◯",
        じめん: " ",
        ひこう: "×",
        エスパー: " ",
        むし: "△",
        いわ: "◯",
        ゴースト: " ",
        ドラゴン: " ",
        あく: " ",
        はがね: "◯",
        フェアリー: " ",
    },
    ひこう: {
        ノーマル: " ",
        ほのお: " ",
        みず: " ",
        でんき: "△",
        くさ: "◯",
        こおり: " ",
        かくとう: "◯",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: " ",
        むし: "◯",
        いわ: "△",
        ゴースト: " ",
        ドラゴン: " ",
        あく: " ",
        はがね: "△",
        フェアリー: " ",
    },
    エスパー: {
        ノーマル: " ",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: " ",
        かくとう: "◯",
        どく: "◯",
        じめん: " ",
        ひこう: " ",
        エスパー: "△",
        むし: " ",
        いわ: " ",
        ゴースト: " ",
        ドラゴン: " ",
        あく: "×",
        はがね: "△",
        フェアリー: " ",
    },
    むし: {
        ノーマル: " ",
        ほのお: "△",
        みず: " ",
        でんき: " ",
        くさ: "◯",
        こおり: " ",
        かくとう: "△",
        どく: "△",
        じめん: " ",
        ひこう: "△",
        エスパー: "◯",
        むし: " ",
        いわ: " ",
        ゴースト: "△",
        ドラゴン: " ",
        あく: "◯",
        はがね: "△",
        フェアリー: "△",
    },
    いわ: {
        ノーマル: " ",
        ほのお: "◯",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: "◯",
        かくとう: "△",
        どく: " ",
        じめん: "△",
        ひこう: "◯",
        エスパー: " ",
        むし: "◯",
        いわ: " ",
        ゴースト: " ",
        ドラゴン: " ",
        あく: " ",
        はがね: "△",
        フェアリー: " ",
    },
    ゴースト: {
        ノーマル: "×",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: " ",
        かくとう: " ",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: "◯",
        むし: " ",
        いわ: " ",
        ゴースト: "◯",
        ドラゴン: " ",
        あく: "△",
        はがね: " ",
        フェアリー: " ",
    },
    ドラゴン: {
        ノーマル: " ",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: " ",
        かくとう: " ",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: " ",
        むし: " ",
        いわ: " ",
        ゴースト: " ",
        ドラゴン: "◯",
        あく: " ",
        はがね: "△",
        フェアリー: "×",
    },
    あく: {
        ノーマル: " ",
        ほのお: " ",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: " ",
        かくとう: "△",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: "◯",
        むし: " ",
        いわ: " ",
        ゴースト: "◯",
        ドラゴン: " ",
        あく: "△",
        はがね: " ",
        フェアリー: "△",
    },
    はがね: {
        ノーマル: " ",
        ほのお: "△",
        みず: "△",
        でんき: "△",
        くさ: " ",
        こおり: "◯",
        かくとう: " ",
        どく: " ",
        じめん: " ",
        ひこう: " ",
        エスパー: " ",
        むし: " ",
        いわ: "◯",
        ゴースト: " ",
        ドラゴン: " ",
        あく: " ",
        はがね: "△",
        フェアリー: "◯",
    },
    フェアリー: {
        ノーマル: " ",
        ほのお: "△",
        みず: " ",
        でんき: " ",
        くさ: " ",
        こおり: " ",
        かくとう: "◯",
        どく: "△",
        じめん: " ",
        ひこう: " ",
        エスパー: " ",
        むし: " ",
        いわ: " ",
        ゴースト: " ",
        ドラゴン: "◯",
        あく: "◯",
        はがね: "△",
        フェアリー: " ",
    }
}

const toLeverage = (c: Compatibility): number => {
    switch (c) {
        case " ": return 1;
        case "◯": return 2;
        case "△": return 0.5;
        case "×": return 0;
    }
}

export const calcAttackLeverage = (type1: PokemonType, type2: PokemonType | undefined, skillType: PokemonType, pokemonType1: PokemonType, pokemonType2: PokemonType | undefined): number => {
    return (pokemonType1 == skillType || pokemonType2 == skillType ? 1.5 : 1) * toLeverage(TypeCompatibilityList[skillType][type1])
        * (type2 ? toLeverage(TypeCompatibilityList[skillType][type2]) : 1)
}

export const calcDefenceLeverage = (target: Pokemon, partyPokemon: PartyPokemon): number => {
    return Math.max(
        calcAttackLeverage(partyPokemon.type1, partyPokemon.type2, target.type1, target.type1, target.type2 !== "" ? target.type2 : undefined),
        target.type2 === "" ? 0 : calcAttackLeverage(partyPokemon.type1, partyPokemon.type2, target.type2, target.type1, target.type2)
    )
}